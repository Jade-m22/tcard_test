:root{
  --card-w: 360px;
  --card-h: 560px;
  --radius: 18px;

  --ring: rgba(255,255,255,.10);
  --glass: rgba(255,255,255,.14);
  --glass-weak: rgba(255,255,255,.08);
  --stroke: rgba(255,255,255,.18);
}

*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0; overflow-x:hidden; 
  background:
    radial-gradient(60% 60% at 20% 15%, #15161d 0%, #0e1016 45%, #080b11 100%),
    #000;
  color:#fff;
  font: 14px/1.5 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

.topbar{
  display:flex; align-items:center; justify-content:space-between; gap:16px;
  padding:12px 14px; border-bottom:1px solid rgba(255,255,255,.08);
  position:sticky; top:0; background:rgba(10,12,16,.75);
  backdrop-filter: blur(8px); z-index:10;
}
.topbar .left h1{ font-size:16px; margin:0 0 2px }

.btn{
  background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12);
  padding:8px 12px; border-radius:12px; color:#fff; cursor:pointer
}
.file-btn{ display:flex; align-items:center; gap:8px; cursor:pointer }

.importer{ position:relative }
.importer[open] summary{ border-bottom-left-radius:0; border-bottom-right-radius:0 }
.importer summary{ list-style:none }
.importer summary::-webkit-details-marker{ display:none }
.import-grid{
  position:absolute; right:0; margin-top:8px; display:grid; grid-template-columns: 1fr 1fr; gap:8px;
  background:rgba(15,17,23,.96); padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,.10);
  backdrop-filter: blur(8px);
}

.layout{
  display:grid;
  grid-template-columns:
    clamp(200px, 18vw, 240px)   
    clamp(100px, 10vw, 140px)   
    minmax(480px, 1fr)          
    clamp(260px, 24vw);  
  grid-template-areas: "thumbs drops stage right";
  gap:18px;
  padding:22px;
  align-items:start;
  max-width:100vw;
}

.thumbs-rail, .drops-rail, .stage, .sidebar{
  min-width:0; 
}

.thumbs-rail, .drops-rail, .sidebar{
  position: sticky; top: 72px;
  max-height: calc(100vh - 96px);
  overflow: auto;
}

.thumbs-rail{ grid-area:thumbs; display:flex; flex-direction:column; gap:16px; }
.thumbs-handle{
  display:none;
  background: rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.15);
  padding:8px 10px; border-radius:10px; color:#fff; cursor:pointer;
}
.thumbs-flyout{
  position: static;
  border:1px solid rgba(255,255,255,.12);
  border-radius: 12px;
  background: rgba(10,12,16,.9);
  backdrop-filter: blur(8px);
}
.thumbs-flyout.closed{ display:none; }
.thumbs-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
.thumbs{
  display:grid; grid-template-columns: repeat(3, 1fr); gap:6px;
}
.thumb{
  width:100%; aspect-ratio:1/1; object-fit:cover; border-radius:8px;
  border:1px solid rgba(255,255,255,.12); cursor:pointer; opacity:.95;
  transition: transform .12s ease, opacity .12s ease, box-shadow .12s ease;
}
.thumb:hover{ transform: translateY(-1px); opacity:1; }
.thumb.selected{ box-shadow: 0 0 0 2px rgba(255,255,255,.6) inset; }
.thumb-empty{
  display:grid; place-items:center; font-size:12px; color:rgba(255,255,255,.7);
  background: repeating-linear-gradient(45deg, rgba(255,255,255,.08) 0 6px, rgba(255,255,255,.04) 6px 12px);
  border:2px dashed rgba(255,255,255,.45);
}
.thumb.used-bg{ outline:1px dashed #ff5a5a; outline-offset:2px; box-shadow:0 0 0 1px rgba(255,90,90,.35) inset; }
.thumb.used-face{ outline:1px dashed #4ea1ff; outline-offset:2px; box-shadow:0 0 0 1px rgba(78,161,255,.35) inset; }
.thumb.used-wm{ outline:1px dashed #38d57a; outline-offset:2px; box-shadow:0 0 0 1px rgba(56,213,122,.35) inset; }
.thumbs.dropping{
  outline: 2px dashed rgba(255,255,255,.45);
  outline-offset: 4px;
  background: rgba(255,255,255,.06);
}

.drops-rail{ grid-area:drops; }
.drop-panel{ max-width: 100%; }
.drop-panel h2{ font-size:12px; text-align:center; margin:0 0 8px; }
.drop-zones{ display:flex; flex-direction:column; gap:8px; }
.drop-zone{
  border:1px dashed rgba(255,255,255,.45);
  border-radius:10px; padding:10px; text-align:center; opacity:.95; font-size:11px;
  background: rgba(255,255,255,.04);
  transition: background .12s ease, border-color .12s ease;
}
.drop-zone:hover{ background: rgba(255,255,255,.06); }
.drop-zone.dropping{ background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.75); }
.drop-target.dropping{
  box-shadow: 0 0 0 3px rgba(255,255,255,.35) inset, 0 0 0 2px rgba(255,255,255,.25);
  filter: brightness(1.08) saturate(1.04);
}
.drop-zone.has-bg{ border-color:#ff5a5a; box-shadow:0 0 0 1px rgba(255,90,90,.35) inset; }
.drop-zone.has-face{ border-color:#4ea1ff; box-shadow:0 0 0 1px rgba(78,161,255,.35) inset; }
.drop-zone.has-wm{ border-color:#38d57a; box-shadow:0 0 0 1px rgba(56,213,122,.35) inset; }

.stage{
  grid-area:stage;
  display:flex; align-items:center; justify-content:center;
  min-height: calc(100vh - 180px);
  padding: 0 8px;
}
.card{
  isolation:isolate;
  position:relative; width:var(--card-w); height:var(--card-h);
  border-radius:var(--radius); overflow:hidden; background:#0f1117;
  transform-style:preserve-3d;
  box-shadow:
    0 24px 60px rgba(0,0,0,.55),
    inset 0 1px 0 rgba(255,255,255,.05),
    inset 0 0 0 1px var(--ring);
  transition: transform .12s ease-out;
  will-change: transform;
  margin:0 auto;
}
.bg-img{
  position:absolute; inset:0; width:100%; height:100%; object-fit:cover;
  z-index:0; filter: brightness(1.06) saturate(1.04) contrast(0.98);
}
.card-img{
  position:absolute; inset:0; width:100%; height:100%; object-fit:cover;
  z-index:1; filter: brightness(1.04) saturate(1.03) contrast(0.99);
}
.wm-img{
  position:absolute; inset:-4%;
  z-index:2; width:108%; height:108%; object-fit:cover;
  pointer-events:none; opacity:0; mix-blend-mode: screen;
  filter: brightness(1.12) saturate(1.06) contrast(0.98);
  transform: translate3d(0,0,0) scale(1.02);
  transition: opacity .12s ease-out, transform .1s ease-out;
}
.glare{
  position:absolute; inset:-20%; pointer-events:none; mix-blend-mode: screen;
  filter: blur(22px); opacity:.0; transition: opacity .15s ease-out;
}
.frame-img{
  position:absolute; inset:0; width:100%; height:100%; object-fit:cover;
  pointer-events:none; z-index:4;
}

.liquid-frame{
  position:absolute; inset:14px; border-radius:calc(var(--radius) - 6px);
  pointer-events:none; z-index:4;
}
.avatar-panel{
  position:absolute; top:14px; left:14px;
  width:80px; height:80px; border-radius:999px; overflow:hidden;
  backdrop-filter: blur(8px) saturate(1.05);
  background: linear-gradient(180deg, var(--glass), rgba(255,255,255,.02));
  border:1px solid var(--stroke);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.28), 0 6px 20px rgba(0,0,0,.35);
  z-index:2;
}
.avatar-panel img{ width:100%; height:100%; object-fit:cover; display:block; opacity:.95; }
.avatar-ring{
  position:absolute; inset:-2px; border-radius:inherit; pointer-events:none;
  --b:2px;
  background:
    conic-gradient(from 0deg,
      rgba(255,255,255,.0),
      rgba(255,255,255,.75),
      rgba(255,255,255,.10),
      rgba(255,255,255,.0) 70%,
      rgba(255,255,255,.7) 100%) 0 0/200% 200% no-repeat;
  animation: ring-scan 6s linear infinite;
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  padding: var(--b);
}
@keyframes ring-scan { to { background-position:200% 200%; } }

.info-panel{
  position:absolute; left:50%; bottom:20px; transform:translateX(-50%);
  width: calc(100% - 80px); padding: 8px; border-radius: 12px;
  background: linear-gradient(180deg, var(--glass), rgba(255,255,255,.05));
  border:1px solid var(--stroke);
  backdrop-filter: blur(8px) saturate(1.05);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.22), 0 8px 28px rgba(0,0,0,.3);
}
.info-grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap:6px; }
.info-grid.dynamic-2{ grid-template-columns: repeat(2, 1fr); }
.info-grid.dynamic-1{ grid-template-columns: 1fr; }
.info-cell{
  border-radius: 8px; background: var(--glass-weak); border:1px solid rgba(255,255,255,.14);
  backdrop-filter: blur(6px); display:flex; align-items:center; justify-content:space-between;
  padding: 6px 8px; font-size: 10px; min-width:0; min-height:28px;
}
.info-cell .k{ font-size: 6px; letter-spacing:.05em; text-transform:uppercase; opacity:.85; }
.info-cell .v{ font-weight:600; font-size: 6px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

.sidebar{
  grid-area:right;
  display:flex; flex-direction:column; gap:16px;
}
.cta-random{
  display:block; width:100%;
  padding:10px 14px; border-radius:12px; cursor:pointer;
  border:1px solid rgba(78,161,255,.5);
  background: linear-gradient(180deg, rgba(78,161,255,.20), rgba(78,161,255,.10));
  color:#fff; font-weight:700; letter-spacing:.02em;
  box-shadow: 0 8px 24px rgba(78,161,255,.18), inset 0 1px 0 rgba(255,255,255,.18);
}
.cta-random:hover{ filter: brightness(1.05); }
.cta-random:hover .random-icon{ animation: spin 0.6s ease-in-out; }
.random-icon{ 
  display: inline-block; 
  font-size: 18px; 
  transition: transform 0.2s ease;
}
@keyframes spin { 
  from { transform: rotate(0deg); } 
  to { transform: rotate(360deg); } 
}
.btn-accent{
  border-color: rgba(78,161,255,.6) !important;
  background: linear-gradient(180deg, rgba(78,161,255,.20), rgba(78,161,255,.10)) !important;
  box-shadow: 0 4px 14px rgba(78,161,255,.15), inset 0 1px 0 rgba(255,255,255,.18);
}

.panel{
  padding:10px; border:1px solid rgba(255,255,255,.08); border-radius:12px;
  background:rgba(255,255,255,.04); backdrop-filter: blur(6px);
}
.panel h2{ font-size:13px; margin:0 0 8px; }

.panel h3{ font-size:12px; margin:0 0 8px; opacity:.9 }
.panel .row{ display:flex; align-items:center; gap:10px; margin:8px 0; }
.panel .row label{ width:110px; font-size:12px; opacity:.9 }
.panel .row input[type="range"], .panel .row select{
  flex:1; padding:6px 8px; border-radius:10px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.08); color:#fff;
}
.panel .row input[type="range"]{ height:28px }
.panel .row:last-child{ margin-top:12px }

#personalize .panel:first-of-type{ margin-bottom:16px; }

.controls{
  display:flex; flex-direction:column; gap:8px; margin-top:8px;
  padding-top:8px; border-top:1px solid rgba(255,255,255,.08);
}
.control-row{
  display:flex; align-items:center; justify-content:space-between; gap:8px; font-size:12px;
}
.control-row select, .control-row input[type="range"]{
  padding:6px 8px; border:1px solid rgba(255,255,255,.20); border-radius:8px;
  background:rgba(255,255,255,.08); color:#fff; font-size:12px;
}
.control-row input[type="range"]{ width:80px; }

.visibility-inline{ margin-bottom:12px; }
.vis-grid{
  display:grid; grid-template-columns: repeat(2, 1fr); gap:6px;
}
.switch{
  display:flex; align-items:center; gap:8px; padding:6px 8px; border-radius:10px;
  border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.04);
}

.composer-table{ width:100%; border-collapse:collapse; font-size:12px; }
.composer-table th, .composer-table td{ border:1px solid rgba(255,255,255,.12); padding:6px; text-align:left; }
.composer-table th{ background:rgba(255,255,255,.06); font-weight:600; }
.composer-table select{ width:100%; padding:6px 8px; border-radius:8px; border:1px solid rgba(255,255,255,.20); background:rgba(255,255,255,.08); color:#fff; }
.composer-table .apply{ padding:6px 10px; border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.08); color:#fff; border-radius:8px; cursor:pointer }
.composer-table .apply:hover{ background:rgba(255,255,255,.12); }
.composer-table .row-rand.big{ font-size:18px; padding:4px 8px; }
.composer-table .row-rand:hover .random-icon{ animation: spin 0.4s ease-in-out; }
.composer-table .show-toggle{ 
  width:16px; height:16px; cursor:pointer; 
  accent-color: #4ea1ff;
}

.hidden{ display:none !important; }
.is-empty{ display:none !important; }
@media (prefers-reduced-motion: reduce){
  .card, .wm-img, .glare { transition:none; }
  .avatar-ring{ animation:none; }
}

@media (max-width: 1400px){
  .layout{
    grid-template-columns:
      clamp(200px, 22vw, 260px)   
      minmax(520px, 1fr)          
      clamp(240px, 28vw, 300px);  
    grid-template-areas:
      "thumbs stage right"
      "drops  stage right";
  }
  .thumbs-rail, .drops-rail, .stage, .sidebar{ min-width:0; }
}

@media (max-width: 1200px){
  .layout{
    grid-template-columns:
      clamp(180px, 24vw, 240px)
      1fr
      clamp(220px, 32vw, 280px);
  }
  .thumbs{ grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 980px){
  .layout{
    grid-template-columns: 1fr;
    grid-template-areas:
      "thumbs"
      "drops"
      "stage"
      "right";
  }
  .thumbs-rail, .drops-rail, .sidebar{
    position: static; max-height: none; overflow: visible;
  }
  .thumbs-handle{ display:block; }
  .thumbs-flyout.closed{ display:none; }
  .stage{ min-height: 0; }
  .thumbs{ grid-template-columns: repeat(4, 1fr); }
}
